#!/bin/bash

######################################
#                                    #
#   Author  : Youri Klaassens        #
#   Alias   : Xhendos                #
#   Date    : 12th of August, 2017   #
#                                    #
######################################

# Generates random IPs and check if they got port a specified port open. (Depends on command line argument)
# It makes use of Nmap to generate and test the IPs.
# While testing the IPs, it will write an IP to a file away if matched.
# Usage: ./get_ip.sh [Number of hosts to scan] [What port to scan] [Filename to write output]

AMOUNT=$1
PORT=$2
FILE_NAME=$3


OUTPUT=$(nmap -iR $AMOUNT -p $PORT --open)

printf '%s\n' "$OUTPUT" | while IFS= read -r LINE
do
        if [[ $LINE == Nmap*  ]] && [[ $LINE != *seconds ]]
        then
                IP=$(printf "$LINE\n" | rev | cut -d " " -f1 | rev | tr -d "(" | tr -d ")")
                echo $IP >> $FILE_NAME
        fi
done
